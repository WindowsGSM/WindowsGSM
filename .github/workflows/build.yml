name: Release Build

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]
  workflow_dispatch:

jobs:
  build:
    name: Build Release
    runs-on: windows-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    - name: Setup NuGet
      uses: NuGet/setup-nuget@v1.2.0

    - name: Restore NuGet Packages
      run: nuget restore WindowsGSM.sln

    - name: Build with Legacy MSBuild
      # Using the legacy MSBuild path as required by the project structure and documented in copilot-instructions.md
      run: |
        & "C:\Windows\Microsoft.NET\Framework64\v4.0.30319\MSBuild.exe" WindowsGSM.sln /p:Configuration=Release /p:Platform="Any CPU"

    - name: Upload WindowsGSM.exe
      uses: actions/upload-artifact@v4
      with:
        name: WindowsGSM-Release
        path: WindowsGSM/bin/Release/WindowsGSM.exe
